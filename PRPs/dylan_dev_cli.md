name: "Dylan Dev CLI Implementation"
description: |
A new command for the Dylan CLI that automates the implementation of fixes based on code reviews generated by the dylan review command.

## Goal

Create a new `dylan dev` command that automatically implements fixes for issues identified by the `dylan review` command, prioritizing critical and high-severity issues, and integrates seamlessly with the existing Dylan CLI workflow.

## Why

- **Efficiency**: Automates the manual process of fixing issues identified in code reviews, saving developer time
- **Consistency**: Ensures that fixes follow best practices and coding standards consistently
- **Completion**: Completes the review → dev → PR workflow, providing a comprehensive solution for code quality improvement
- **Quality**: Implements changes in a structured, methodical way, reducing the chance of introducing new issues
- **Documentation**: Provides detailed reports on what changes were made and why, improving transparency and knowledge sharing
- **Integration**: Integrates seamlessly with the existing Dylan CLI workflow
- **Flexibility**: Allows for customizing the fix implementation process

## What

The `dylan dev` command will:

- Accept a review file generated by `dylan review` as input
- Leverage Claude Code to implement fixes for issues, prioritizing critical and high-severity issues by default, but allowing for customizing to accept medium and low severity issues as well
- Apply fixes to the current branch or a designated branch
- Generate a development report detailing changes made
- Support various options for controlling the fix implementation process
- Integrate with the existing Dylan CLI architecture and UI components

## Current Directory Structure

```
dylan/
├── cli.py                                # Main CLI entry point
├── utility_library/
│   ├── dylan_review/                     # Review functionality
│   │   ├── __init__.py
│   │   ├── dylan_review_cli.py           # Review CLI interface
│   │   └── dylan_review_runner.py        # Review core functionality
│   ├── dylan_pr/                         # PR functionality
│   │   ├── __init__.py
│   │   ├── dylan_pr_cli.py               # PR CLI interface
│   │   └── dylan_pr_runner.py            # PR core functionality
│   ├── provider_clis/                    # Provider interfaces
│   │   ├── __init__.py
│   │   ├── provider_claude_code.py       # Claude Code provider
│   │   └── shared/
│   │       ├── __init__.py
│   │       └── subprocess_utils.py       # Subprocess utilities
│   └── shared/                           # Shared utilities and UI components
│       ├── __init__.py
│       ├── config.py                     # Configuration
│       ├── error_handling.py             # Error handling
│       ├── exit_command.py               # Exit command handling
│       ├── progress.py                   # Progress reporting
│       └── ui_theme.py                   # UI theme components
```

## Proposed Directory Structure

```
dylan/
├── cli.py                                # Updated to add dev command
├── utility_library/
│   ├── dylan_review/                     # Existing review functionality
│   │   ├── __init__.py
│   │   ├── dylan_review_cli.py
│   │   └── dylan_review_runner.py
│   ├── dylan_dev/                        # New dev functionality
│   │   ├── __init__.py
│   │   ├── dylan_dev_cli.py              # Dev CLI interface
│   │   └── dylan_dev_runner.py           # Dev core functionality
│   ├── dylan_pr/                         # Existing PR functionality
│   │   ├── __init__.py
│   │   ├── dylan_pr_cli.py
│   │   └── dylan_pr_runner.py
│   └── ... (other existing directories)
```

## Files to Reference

- `/Users/rasmus/Projects/claudecode-utility/concept_library/simple_dev/simple_dev_poc.py` (read_only) Reference implementation of the dev concept
- `/Users/rasmus/Projects/claudecode-utility/dylan/utility_library/dylan_review/dylan_review_cli.py` (read_only) Pattern for CLI interface implementation
- `/Users/rasmus/Projects/claudecode-utility/dylan/utility_library/dylan_review/dylan_review_runner.py` (read_only) Pattern for runner implementation
- `/Users/rasmus/Projects/claudecode-utility/dylan/utility_library/provider_clis/provider_claude_code.py` (read_only) Provider interface for Claude Code
- `/Users/rasmus/Projects/claudecode-utility/dylan/cli.py` (read_only) Main CLI entry point to be updated
- `/Users/rasmus/Projects/claudecode-utility/dylan/utility_library/shared/ui_theme.py` (read_only) UI theme components for consistent look and feel

## Files to Implement (concept)

### Core CLI Module

1. `dylan/utility_library/dylan_dev/__init__.py` - Empty init file for the package

```python
"""Dylan Development module for implementing fixes from code reviews."""
```

2. `dylan/utility_library/dylan_dev/dylan_dev_cli.py` - CLI interface for the dev command

```python
#!/usr/bin/env python3
"""CLI interface for the Claude Code development runner using Typer."""

import typer
from rich.console import Console

from ..shared.ui_theme import (
    create_box_header,
    create_header,
    format_boolean_option,
)
from .dylan_dev_runner import generate_dev_prompt, run_claude_dev

console = Console()


def dev(
    review_file: str = typer.Argument(
        ...,
        help="Path to the review file to use as input (review file must be provided with relative path)",
        metavar="REVIEW_FILE",
    ),
    branch: str | None = typer.Option(
        None,
        "--branch",
        "-b",
        help="Branch to apply fixes to defaults to current branch",
        show_default=True,
    ),
    output: str | None = typer.Option(
        None,
        "--output",
        "-o",
        help="Custom output file path for dev report (defaults to tmp/dylan-dev-report-<branch>.md)",
        show_default=True,
    ),
    issue: str | None = typer.Option(
        None,
        "--issue",
        "-i",
        help="Specify issue numbers from the review file to fix (default: all issues) (comma-separated issue numbers 001, 002, ...)",
        show_default=True,
    ),
    severity: str = typer.Option( # this should overide issues
        "critical,high",
        "--severity",
        "-s",
        help="Only fix issues with specified severity (default: high and critical) (comma-separated: critical, high, medium, low)",
        show_default=True,
    ),
    interactive: bool = typer.Option(
        False,
        "--interactive",
        "-i",
        help="Run in interactive mode", # (use the shared interactive module)
        show_default=True,
    ),
    dry_run: bool = typer.Option(
        False,
        "--dry-run",
        help="Preview changes without applying any fixes",
        show_default=True,
    ),
    debug: bool = typer.Option(
        False,
        "--debug",
        "-d",
        help="Print debug information (including the full prompt)",
        show_default=True,
    ),
):
    """Implement fixes from code reviews using Claude Code.

    Takes a review file generated by 'dylan review' and implements fixes
    for issues based on priority. Generates a development report detailing
    changes made.

    Examples:
        # Implement fixes from a review file
        dylan dev tmp/dylan-review-compare-feature-branch-to-develop.md

        # Implement fixes on a specific branch
        dylan dev tmp/dylan-review-compare-feature-branch-to-develop.md --branch feature-branch

        # Only fix critical issues
        dylan dev tmp/dylan-review-compare-feature-branch-to-develop.md --severity "critical"

        # Only fix issues in specific tasks
        dylan dev tmp/dylan-review-compare-feature-branch-to-develop.md --issue "001, 002" (accepts comma-separated issue numbers)

        # Run in interactive mode (interactive is default)
        dylan dev tmp/dylan-review-compare-feature-branch-to-develop.md --interactive

        # Preview changes without applying any fixes
        dylan dev tmp/dylan-review-compare-feature-branch-to-develop.md --dry-run
    """
    # Default values
    allowed_tools = ["Read", "Glob", "Grep", "LS", "Bash", "Edit", "MultiEdit", "Write", "TodoRead", "TodoWrite"]
    output_format = "text"
    debug = False

    *** MIRROR the dylan/utility_library/dylan_review/dylan_review_cli.py file adapted for our dev use case ***

```

3. `dylan/utility_library/dylan_dev/dylan_dev_runner.py` - Core implementation of the dev command

````python
#!/usr/bin/env python3
"""Core functionality for the Claude Code development runner.

This module provides the functionality to parse review files and implement fixes
based on the issues identified, prioritizing critical and high-severity issues.

Python API usage:
    from dylan.utility_library.dylan_dev.dylan_dev_runner import run_claude_dev, generate_dev_prompt

    # Generate prompt from review file
    prompt = generate_dev_prompt(review_file="tmp/review.md")

    # Run development process
    run_claude_dev(prompt)
"""

import os
import sys
from pathlib import Path
from typing import Literal, List

from rich.console import Console

from ..provider_clis.provider_claude_code import get_provider
from ..shared.config import (
    CLAUDE_CODE_NPM_PACKAGE,
    CLAUDE_CODE_REPO_URL,
    GITHUB_ISSUES_URL,
)
from ..shared.progress import create_dylan_progress, create_task_with_dylan
from ..shared.ui_theme import ARROW, COLORS, SPARK, create_status

console = Console()


def run_claude_dev(
    prompt: str,
    allowed_tools: list[str] | None = None,
    branch: str | None = None,
    output_format: Literal["text", "json", "stream-json"] = "text",
    debug: bool = False,
) -> None:
    """Run Claude Code with a development prompt and specified tools.

    Args:
        prompt: The development prompt to send to Claude
        allowed_tools: List of allowed tools (defaults to Read, Glob, Grep, LS, Bash, Write, Edit, MultiEdit)
        branch: Optional branch to apply fixes to (not used in this implementation)
        output_format: Output format (text, json, stream-json)
        debug: Whether to print debug information (default False)
    """
    # Default safe tools for development
    if allowed_tools is None:
        allowed_tools = ["Read", "Glob", "Grep", "LS", "Bash", "Write", "Edit", "MultiEdit", "TodoRead", "TodoWrite"]

    # Print prompt for debugging
    if debug:
        print("\n===== DEBUG: PROMPT =====\n")
        print(prompt)
        print("\n========================\n")

    *** MIRROR the dylan/utility_library/dylan_review/dylan_review_runner.py file adapted for our dev use case ***

### CLI Entry Point Update

4. `dylan/cli.py` - Updated to add the dev command

```python
"""Root Typer application that dispatches to vertical slices.

Includes 'standup', 'review', 'dev', 'pr', and 'release' commands.
"""

import typer
from rich.console import Console
from rich.table import Table

from .utility_library.dylan_dev.dylan_dev_cli import dev
from .utility_library.dylan_pr.dylan_pr_cli import pr
from .utility_library.dylan_release.dylan_release_cli import release_app
from .utility_library.dylan_review.dylan_review_cli import review
from .utility_library.dylan_standup.standup_typer import standup_app
from .utility_library.shared.ui_theme import ARROW, COLORS, SPARK

console = Console()

app = typer.Typer(
    help=f"[{COLORS['primary']}]Dylan[/] [{COLORS['accent']}]{SPARK}[/] AI-powered development utilities",
    add_completion=False,
    no_args_is_help=False,
    pretty_exceptions_show_locals=False,
    rich_markup_mode="rich",
)
app.add_typer(standup_app, name="standup", help="Generate daily standup reports from git activity")
app.add_typer(release_app, name="release", help="Create and manage project releases")
app.command(name="review", help="Run AI-powered code reviews on git branches")(review)
app.command(name="dev", help="Implement fixes from code reviews")(dev)
app.command(name="pr", help="Create pull requests with AI-generated descriptions")(pr)


@app.callback(invoke_without_command=True)
def _main(ctx: typer.Context) -> None:
    """Show welcome message when no command is provided."""
    if ctx.invoked_subcommand is None:
        # Welcome header with flair
        console.print(f"\n[{COLORS['primary']}]{ARROW}[/] [bold]Dylan[/bold] [{COLORS['accent']}]{SPARK}[/]")
        console.print("[dim]AI-powered development utilities using Claude Code[/dim]\n")

        # Commands table with custom styling
        table = Table(
            show_header=True,
            header_style=f"bold {COLORS['primary']}",
            border_style=COLORS['muted'],
            title_style=f"bold {COLORS['accent']}",
            box=None,
        )

        table.add_column("Command", style=COLORS['secondary'], width=12)
        table.add_column("Description", style=COLORS['primary'])
        table.add_column("Example", style="dim")

        table.add_row(
            "standup",
            "Generate daily standup reports",
            "dylan standup --since yesterday"
        )
        table.add_row(
            "review",
            "Run code reviews on branches",
            "dylan review feature-branch"
        )
        table.add_row(
            "dev",
            "Implement fixes from reviews",
            "dylan dev tmp/review.md"
        )
        table.add_row(
            "pr",
            "Create pull requests",
            "dylan pr --target develop"
        )
        table.add_row(
            "release",
            "Manage project releases",
            "dylan release --minor --tag"
        )

        console.print(table)
        help_text = f"\n[{COLORS['muted']}]Use[/] [{COLORS['primary']}]dylan <command> --help[/]"
        console.print(f"{help_text} [{COLORS['muted']}]for detailed options[/]")
        console.print("[dim]Example: dylan review --help[/dim]\n")
````

## Implementation Notes

### CLI Integration

- The implementation should MIRROR the same pattern as the existing `review` and `pr` commands, maintaining consistency in the UI and user experience
- The command should be implemented as a module with CLI interface and runner components, following the established pattern
- Typer is used for the CLI interface, with rich markdown for styling and UI components

### Development Process

- The implementation should follow a structured approach: Filter issues based on priority and target files Implement fixes for each issue, starting with critical issues Generate a development report detailing the changes made
- The process can be run in interactive mode, where the user is asked for confirmation before each change
- The process can also be run in dry-run mode, where changes are previewed but not applied

### Safety Measures

- Error handling should be implemented at all stages of the process
- The tool should check for the existence of the review file before proceeding
- Changes should be carefully applied, preserving code style and formatting

## Validation Gates

### 1. Functionality Requirements

- The command must be accessible via `dylan dev <review_file>`
- The Prompt instructs claude code to read the entire review file and implement fixes for issues based on priority
- The command must generate a development report
- The command must support all specified options

### 2. Integration Requirements

- The command must integrate with the existing Dylan CLI
- The command must follow the same UI patterns as other commands
- The command must use the provider interface for Claude Code

### 3. Quality Requirements

- All code must pass linting and type checking
- All code must have appropriate error handling
- All code must follow the project's coding standards
- The command must provide clear feedback to the user

### 4. Testing Requirements

- Unit tests must be implemented for core functionality

## Implementation Checkpoints/Testing

### 1. CLI Interface Implementation

- Implement the CLI interface in `dylan_dev_cli.py`
- Test the interface by running `python -m dylan.utility_library.dylan_dev.dylan_dev_cli --help`
- Verify the interface is correctly integrated with the main CLI

### 2. Core Functionality Implementation

- Implement the core functionality in `dylan_dev_runner.py`
- Verify that fixes are implemented correctly

## Other Considerations
